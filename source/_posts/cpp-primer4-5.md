title: '头文件'
tags:
  - Cpp
  - Cpp primer
categories:
  - Dev
  - Cpp
date: 2015-11-14 16:31:39
---

到目前为止，我们编写的程序都是把代码都放在同一个文件中来处理。但是很少程序能够都这么简单的由一个文件搞定，由多个文件组成的程序需要一种连接名字的使用和声明，在C++中通过 **头文件** 可以实现。

<!-- more -->

### 一、设计自己的头文件 ###
---

头文件为相关声明提供了一个集中存放的位置。头文件一般包含：

- 类的定义；
- extern变量的声明；
- 函数的声明；

正确使用头文件能带来两个好处：

- 保证所有文件使用给定实体的同一声明；
- 当声明需要修改时，只需要更新头文件即可；

不过也需要注意以下事项：

- 头文件中所做的声明在逻辑上应该是放在一起的；
- 编译头文件需要一定时间；

> 为了减少头文件编译时间，有些C++的实现支持与编译头文件。

#### 1.1、头文件用于声明而不是定义 ####

设计头文件时，记住定义和声明的区别很重要。定义只可以出现一次，而声明可以多次。下面是一些定义，不该出现在头文件中：

```C++
extern int val1 = 10;	//有初始化，是 定义 不是 声明
double val2;			//没有 extern 关键字，是定义
```

> 因为头文件包含在多个源文件中，所以不应该包含有变量或函数的定义。

当然也有另外，头文件中可以定义类、值在编译时就已知的 const 对象和 inline函数（后续介绍）。

#### 1.2、const对象定义在头文件中 ####

前一篇博客提到 const 变量默认是文件的局部变量，正如现在看到的，这样的默认设置原因在于允许 const 变量定义在头文件中。

如果 const 变量不是用常量表达式初始化，那么它就不应该在头文件中定义。相反，和其他变量一样，该 const 变量应该在源文件中定义并初始化。在头文件中用 extern 关键字来声明，以使其能够被多个文件共享。

### 二、预处理器的简单实现 ###
---

#### 2.1、头文件经常需要其他头文件 ####

头文件经常需要使用 `#include` 其他头文件，比如Sales_item类就需要包含string库。包含其他头文件相当正常，甚至有时一个头文件被多次包含进同意源文件也不稀奇。因此设计头文件时，必须保证多次包含同一头文件不会产生歧义。使用 **头文件保护符（header guard）**，用于避免对已经看见头文件却重新处理。

#### 2.2、避免多重包含 ####

在编译头文件之前，我们需要引入一些额外的预处理器设施。预处理器允许我们自定义变量。为避免名字冲突，预处理器变量经常用全大写字母表示。

预处理器变量有两种状态：已定义和未定义。 `#define` 表示接受一个名字并定义其为预处理器变量，`#ifndef` 表示检测预处理其变量是否被定义，如果未定义，那么紧跟 `#ifndef` 后面的代码都被处理，直到出现 `#endif`。可以使用下面方式避免多次包含同一头文件

```C++
#ifndef SALESITEM_H
#define SALESITEM_H
//Sales_item 类及其数据和操作在此定义
#endif
```

#### 2.3、自定义头文件 ####

`#include` 接受以下两种形式：

```C++
#include <standard_header>
#include "my_header.h"
```

使用 `<>` 包含的头文件表示该头文件是标准库文件，编译器会在系统预定义的地方查找该头文件。而使用 `""`包含的头文件认为它是非系统头文件，通常会在源文件所在路径开始寻找。

> 至此，第二章 “变量和基本类型” 的内容到此结束，后续开始第三章 “标准库类型” 的内容。

END.